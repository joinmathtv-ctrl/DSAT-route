<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Digital SAT Practice</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .question { margin-bottom: 25px; padding: 15px; border: 1px solid #ccc; border-radius: 8px; }
    .choices { margin-top: 10px; }
    .choices label { display: block; margin: 4px 0; }
    img { max-width: 100%; height: auto; display: block; margin: 8px 0; }
    table { border-collapse: collapse; margin-top: 8px; }
    table, th, td { border: 1px solid #444; padding: 6px; }
  </style>
</head>
<body>
  <h1>Digital SAT Practice</h1>
  <div id="questions"></div>

<script>
function renderMediaPlaceholders(html) {
  return html.replace(/\[\[IMAGE:\s*([^\]|]+)(?:\s*\|\s*([^\]]+))?\]\]/g,
    (_, file, opts) => {
      let src = `./img/${file.trim()}`;
      let alt = 'image';
      let extra = 'style="max-width:100%;height:auto"';
      if (opts) {
        opts.split('|').map(s => s.trim()).forEach(pair => {
          const [k,v] = pair.split('=').map(x => x.trim());
          if (!k || !v) return;
          if (k === 'alt') alt = v;
          else if (k === 'width' || k === 'height') extra += ` ${k}="${v}"`;
          else if (k === 'class')  extra += ` class="${v}"`;
          else if (k === 'style')  extra += ` style="${v}"`;
        });
      }
      return `<img src="${src}" alt="${alt}" ${extra}>`;
  });
}

async function loadQuestions() {
  const res = await fetch("./questions_fixed.json");
  const data = await res.json();
  const container = document.getElementById("questions");

  data.modules.forEach(mod => {
    mod.questions.forEach(q => {
      let div = document.createElement("div");
      div.className = "question";
      div.innerHTML = `<b>Q${q.id}:</b> ${renderMediaPlaceholders(q.prompt)}`;

      if (q.type === "mcq") {
        let choicesDiv = document.createElement("div");
        choicesDiv.className = "choices";
        q.choices.forEach((c,i) => {
          let choiceHTML = renderMediaPlaceholders(c);
          choicesDiv.innerHTML += `<label><input type="radio" name="${q.id}"> ${choiceHTML}</label>`;
        });
        div.appendChild(choicesDiv);
      } else if (q.type === "gridin") {
        div.innerHTML += `<div><input type="text" placeholder="Your answer"></div>`;
      }

      container.appendChild(div);
    });
  });

  MathJax.typeset();
}

loadQuestions();
</script>
</body>
</html>
