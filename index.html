<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DSAT Practice - Landing</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; background: #f9f9f9; }
    .card { border: 1px solid #ccc; background: #fff; padding: 1em; margin: 1em 0; border-radius: 8px; }
    button { padding: 0.5em 1em; margin-top: 1em; }
    #app { max-width: 800px; margin: auto; }
  </style>
</head>
<body>
<div id="app"></div>
<script>
let app = document.getElementById("app");
let sets = [];

function renderLanding() {
  app.innerHTML = `
    <h1>DSAT Practice</h1>
    <p>Select a problem set:</p>
    <input type="file" id="fileInput" multiple><br><br>
    <input type="text" id="urlInput" placeholder="Enter JSON URL (e.g. ./questions.json)">
    <button onclick="loadFromUrl()">Load from URL</button>
    <div id="setList"></div>
  `;
  document.getElementById("fileInput").addEventListener("change", e => {
    Array.from(e.target.files).forEach(file => {
      let reader = new FileReader();
      reader.onload = ev => {
        let data = JSON.parse(ev.target.result);
        sets.push(data);
        renderSetList();
      };
      reader.readAsText(file);
    });
  });
}

function loadFromUrl() {
  let url = document.getElementById("urlInput").value;
  fetch(url).then(r => r.json()).then(data => {
    sets.push(data);
    renderSetList();
  }).catch(err => alert("Error loading: "+err));
}

function renderSetList() {
  let html = sets.map((s,i) => `
    <div class="card">
      <h3>${s.metadata.title}</h3>
      <p>Section: ${s.metadata.section} | Modules: ${s.modules.length}</p>
      <button onclick="viewInfo(${i})">View Info</button>
    </div>
  `).join("");
  document.getElementById("setList").innerHTML = html;
}

function viewInfo(idx) {
  let s = sets[idx];
  let dur = (s.metadata.durationMinutesPerModule||[]).join(", ");
  app.innerHTML = `
    <button onclick="renderLanding()">‚Üê Back</button>
    <h2>${s.metadata.title}</h2>
    <p>Section: ${s.metadata.section}</p>
    <p>Directions: ${s.metadata.directions}</p>
    <p>Modules: ${s.modules.length}</p>
    <p>Duration per module: ${dur} minutes</p>
    <button onclick="startTest(${idx})">Start Test</button>
  `;
}

function startTest(idx) {
  let s = sets[idx];
  window.sessionStorage.setItem("dsat_current_set", JSON.stringify(s));
  window.location.href = "test.html";
}

renderLanding();
</script>
</body>
</html>
