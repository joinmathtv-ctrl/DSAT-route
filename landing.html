<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ë””ì§€í„¸ SAT ì—°ìŠµ â€” ì„¸íŠ¸ ì„ íƒ</title>
<style>
  :root{
    --bg:#f6f7fb; --card:#fff; --ink:#111827; --muted:#6b7280;
    --line:#e5e7eb; --accent:#2563eb; --ok:#16a34a; --bad:#ef4444;
  }
  *{box-sizing:border-box}
  body{margin:0; font-family:Inter,system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Arial,sans-serif; color:var(--ink); background:var(--bg)}
  a{color:inherit; text-decoration:none}
  .wrap{max-width:1100px; margin:32px auto 60px; padding:0 14px}
  header{display:flex; gap:12px; align-items:center; justify-content:space-between; margin-bottom:16px}
  h1{font-size:22px; margin:0}
  .view-toggle{display:flex; gap:6px}
  .btn{border:1px solid var(--line); background:#fff; padding:8px 12px; border-radius:10px; cursor:pointer}
  .btn.primary{background:var(--accent); color:#fff; border-color:var(--accent)}
  .card{background:var(--card); border:1px solid var(--line); border-radius:14px; box-shadow:0 6px 20px rgba(0,0,0,.04)}
  .search{display:flex; gap:8px; align-items:center; background:var(--card); border:1px solid var(--line); border-radius:12px; padding:10px 12px}
  .search input{border:none; outline:none; flex:1; font-size:14px}
  .grid{display:grid; grid-template-columns:repeat(3, 1fr); gap:14px}
  .grid.list{grid-template-columns:1fr}
  .item{display:flex; flex-direction:column; overflow:hidden}
  .thumb{position:relative; background:#e9eefc; height:140px; display:grid; place-items:center}
  .thumb img{width:100%; height:100%; object-fit:cover}
  .thumb .fallback{font-size:42px; opacity:.4}
  .body{padding:12px}
  .title{font-weight:800; margin-bottom:4px}
  .sub{font-size:13px; color:var(--muted); margin-bottom:8px}
  .tags{display:flex; flex-wrap:wrap; gap:6px; margin-bottom:10px}
  .tag{font-size:12px; padding:2px 8px; background:#eef2ff; color:#1e40af; border-radius:999px; border:1px solid #e0e7ff}
  .meta{display:flex; gap:10px; color:#374151; font-size:13px; margin-bottom:10px}
  .meta b{font-weight:700}
  .foot{display:flex; gap:8px; justify-content:flex-end; padding:12px}
  .row{display:grid; grid-template-columns:140px 1fr; gap:12px; align-items:center}
  .uploader{border:1px dashed var(--line); border-radius:12px; padding:12px; background:#fafafa}
  .note{color:var(--muted); font-size:12px}
  .recents{display:flex; gap:8px; flex-wrap:wrap}
  .pill{border:1px solid var(--line); background:#fff; padding:6px 10px; border-radius:999px; font-size:12px; cursor:pointer}
  @media (max-width:980px){ .grid{grid-template-columns:repeat(2, 1fr)} }
  @media (max-width:640px){
    header{flex-direction:column; align-items:flex-start; gap:8px}
    .grid{grid-template-columns:1fr}
    .row{grid-template-columns:1fr}
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>ë””ì§€í„¸ SAT ì—°ìŠµ â€” ì„¸íŠ¸ ì„ íƒ</h1>
    <div class="view-toggle">
      <button class="btn" id="toGrid">ê·¸ë¦¬ë“œ</button>
      <button class="btn" id="toList">ëª©ë¡</button>
    </div>
  </header>

  <!-- ê²€ìƒ‰/í•„í„° -->
  <div class="search card" style="margin-bottom:14px">
    <input id="q" type="text" placeholder="ì„¸íŠ¸ ì´ë¦„, íƒœê·¸ ê²€ìƒ‰ (ì˜ˆ: math, rw, official)"/>
    <button class="btn" id="clearQ">ì§€ìš°ê¸°</button>
  </div>

  <!-- ì¶”ì²œ ì„¸íŠ¸(ì¹´íƒˆë¡œê·¸) -->
  <section style="margin-bottom:18px">
    <div style="display:flex; justify-content:space-between; align-items:center; margin:6px 2px 10px">
      <div style="font-weight:800">ì¶”ì²œ ì„¸íŠ¸</div>
      <div class="note">ì¹´ë“œ ëª©ë¡ì€ ì•„ë˜ <code>CATALOG</code>ì—ì„œ ììœ ë¡­ê²Œ ìˆ˜ì •</div>
    </div>
    <div class="grid" id="grid"></div>
  </section>

  <!-- ìµœê·¼ ì‹œì‘í•œ ì„¸íŠ¸ -->
  <section style="margin-bottom:18px">
    <div style="display:flex; justify-content:space-between; align-items:center; margin:6px 2px 10px">
      <div style="font-weight:800">ìµœê·¼ ì‚¬ìš©</div>
      <div class="note">í´ë¦­í•˜ë©´ ë°”ë¡œ ì‹œì‘</div>
    </div>
    <div class="recents" id="recents"></div>
  </section>

  <!-- ì§ì ‘ ë¶ˆëŸ¬ì˜¤ê¸° -->
  <section class="card" style="padding:14px">
    <div style="font-weight:800; margin-bottom:10px">ì§ì ‘ ë¶ˆëŸ¬ì˜¤ê¸°</div>
    <div class="row" style="margin:8px 0">
      <label>JSON URL</label>
      <input id="jsonUrl" type="text" placeholder="ì˜ˆ: https://example.com/questions.json" style="padding:10px 12px; border:1px solid var(--line); border-radius:10px"/>
    </div>
    <div class="row" style="margin:8px 0">
      <label>ë¡œì»¬ íŒŒì¼</label>
      <input id="jsonFile" class="uploader" type="file" accept=".json,application/json"/>
    </div>
    <div class="row" style="margin-top:12px">
      <div></div>
      <div class="note">ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ì‚¬ìš©í•˜ì„¸ìš”. URLì´ ìˆìœ¼ë©´ íŒŒì¼ì€ ë¬´ì‹œë©ë‹ˆë‹¤.</div>
    </div>
    <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:12px">
      <button class="btn" id="resetBtn">ì´ˆê¸°í™”</button>
      <button class="btn primary" id="startBtn">ì‹œí—˜ ì‹œì‘</button>
    </div>
  </section>

  <p class="note" style="margin-top:14px">
    íŒ: ì™¸ë¶€ URLì€ CORS ì •ì±…ì— ë”°ë¼ ì°¨ë‹¨ë  ìˆ˜ ìˆì–´ìš”. ë˜ë„ë¡ ê°™ì€ ë„ë©”ì¸ì— JSONì„ ì˜¬ë¦¬ê±°ë‚˜ Netlify/GitHub Pagesì—ì„œ í•¨ê»˜ ë°°í¬í•˜ì„¸ìš”.
  </p>
</div>

<script>
/** ============ ì¹´íƒˆë¡œê·¸(ì›í•˜ëŠ” ë§Œí¼ ìˆ˜ì •í•˜ì„¸ìš”) ============ */
const CATALOG = [
  {
    id: 'default',
    title: 'Sample DSAT Set',
    subtitle: 'RW + Math Â· 4 Modules',
    url: './questions.json',
    thumb: './img/thumb_default.jpg', // ì—†ìœ¼ë©´ ìë™ ëŒ€ì²´
    tags: ['sample','rw','math']
  },
  {
    id: 'step3',
    title: 'Practice Set (Step3 Demo)',
    subtitle: 'ì˜¤í† ì„¸ì´ë¸Œ/í—ˆìš©ì˜¤ì°¨/ì¶”ê°€ë¬¸í•­ ë°ëª¨',
    url: './questions_step3.json',
    thumb: './img/thumb_step3.jpg',
    tags: ['practice','math','rw','demo']
  }
];

/** ============ ê³µí†µ ìœ í‹¸ ============ */
const $ = s => document.querySelector(s);
function h(tag, attrs={}, html=''){
  const el = document.createElement(tag);
  Object.entries(attrs).forEach(([k,v])=>{
    if(k==='class') el.className=v;
    else if(k==='dataset'){ Object.entries(v).forEach(([kk,vv])=> el.dataset[kk]=vv); }
    else if(k.startsWith('on')) el.addEventListener(k.slice(2), v);
    else el.setAttribute(k, v);
  });
  if(html) el.innerHTML = html;
  return el;
}
function startFromURL(url, title){
  try{
    addRecent({type:'url', value:url, title});
  }catch(_e){}
  location.href = `./index.html?set=${encodeURIComponent(url)}`;
}
async function startFromFile(file, title='Local JSON'){
  const text = await file.text();
  localStorage.setItem('dsat_launch_blob', text);
  try{
    addRecent({type:'file', value:title || file.name, title:(title||file.name)});
  }catch(_e){}
  location.href = `./index.html?source=blob`;
}
function addRecent(rec){
  const key='dsat_recents';
  const arr = JSON.parse(localStorage.getItem(key) || '[]');
  // ì¤‘ë³µ ì œê±°
  const filtered = arr.filter(x=> !(x.type===rec.type && x.value===rec.value));
  filtered.unshift({...rec, ts: Date.now()});
  localStorage.setItem(key, JSON.stringify(filtered.slice(0,8)));
}
function renderRecents(){
  const box = $('#recents');
  box.innerHTML='';
  const arr = JSON.parse(localStorage.getItem('dsat_recents') || '[]');
  if(!arr.length){ box.innerHTML = '<span class="note">ì•„ì§ ì—†ìŒ</span>'; return; }
  arr.forEach(r=>{
    const pill = h('button',{class:'pill'});
    pill.textContent = r.title || r.value;
    pill.title = r.type==='url' ? r.value : 'Local file';
    pill.onclick = ()=>{
      if(r.type==='url') startFromURL(r.value, r.title);
      else alert('ë¡œì»¬ íŒŒì¼ì€ ë³´ì•ˆìƒ ìë™ ì¬ì‹œì‘ì´ ì–´ë ¤ì›Œìš”. ì•„ë˜ â€œë¡œì»¬ íŒŒì¼â€ì—ì„œ ë‹¤ì‹œ ì„ íƒí•´ ì£¼ì„¸ìš”.');
    };
    box.appendChild(pill);
  });
}

/** ============ ì¹´ë“œ ë Œë” ============ */
const grid = $('#grid');
function card(item){
  const outer = h('div',{class:'card item', dataset:{id:item.id}});
  const th = h('div',{class:'thumb'});
  const img = new Image();
  img.alt = item.title;
  img.src = item.thumb || '';
  img.onload = ()=> th.appendChild(img);
  img.onerror = ()=> th.innerHTML = '<div class="fallback">ğŸ“</div>';
  outer.appendChild(th);

  const body = h('div',{class:'body'});
  body.appendChild(h('div',{class:'title'}, item.title));
  body.appendChild(h('div',{class:'sub'}, item.subtitle || ''));
  const tags = h('div',{class:'tags'});
  (item.tags||[]).forEach(t=> tags.appendChild(h('span',{class:'tag'}, t)));
  body.appendChild(tags);

  const meta = h('div',{class:'meta'});
  meta.innerHTML = `<div>í˜•ì‹: <b>JSON</b></div><div>ì‹œì‘: <b>ì¦‰ì‹œ</b></div>`;
  body.appendChild(meta);
  outer.appendChild(body);

  const foot = h('div',{class:'foot'});
  const btn = h('button',{class:'btn primary', onclick:()=> startFromURL(item.url, item.title)}, 'ì‹œí—˜ ì‹œì‘');
  const openUrl = h('button',{class:'btn', onclick:()=> window.open(item.url,'_blank')}, 'JSON ë³´ê¸°');
  foot.appendChild(openUrl);
  foot.appendChild(btn);
  outer.appendChild(foot);

  return outer;
}
function render(list){
  grid.innerHTML='';
  list.forEach(item=> grid.appendChild(card(item)));
}

/** ============ ê²€ìƒ‰/ë³´ê¸° ì „í™˜ ============ */
function applyFilter(){
  const q = ($('#q').value || '').trim().toLowerCase();
  if(!q) return render(CATALOG);
  const terms = q.split(/\s+/).filter(Boolean);
  const results = CATALOG.filter(it=>{
    const hay = [it.title, it.subtitle, ...(it.tags||[])].join(' ').toLowerCase();
    return terms.every(t => hay.includes(t));
  });
  render(results);
}
$('#q').addEventListener('input', applyFilter);
$('#clearQ').onclick = ()=>{ $('#q').value=''; applyFilter(); };

$('#toGrid').onclick = ()=> grid.classList.remove('list');
$('#toList').onclick = ()=> grid.classList.add('list');

/** ============ ì§ì ‘ ë¶ˆëŸ¬ì˜¤ê¸° ì„¹ì…˜ ============ */
$('#resetBtn').onclick = ()=>{
  $('#jsonUrl').value=''; $('#jsonFile').value='';
};
$('#startBtn').onclick = async ()=>{
  const url = $('#jsonUrl').value.trim();
  const file = $('#jsonFile').files[0];
  if(url){
    startFromURL(url, 'Custom URL');
    return;
  }
  if(file){
    try{ await startFromFile(file, file.name); }
    catch(e){ alert('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨: ' + e.message); }
    return;
  }
  alert('JSON URLì„ ì…ë ¥í•˜ê±°ë‚˜ ë¡œì»¬ JSON íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.');
};

/** ============ ì´ˆê¸°í™” ============ */
render(CATALOG);
renderRecents();
</script>
</body>
</html>
